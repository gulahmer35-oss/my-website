
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultimate IG / Gamepad Pro Tester</title>
<style>
body { font-family: Arial,sans-serif; background:#001f4d; color:white; text-align:center; margin:0; padding:20px;}
h1{margin-bottom:5px;} p{margin-top:0;color:#aaccff;}
#controllers {display:flex; flex-wrap:wrap; justify-content:center; gap:20px; margin-top:20px;}
.controller {background:#003366; padding:20px; border-radius:15px; width:360px;}
.controller h2{margin-bottom:10px; font-size:1.2em;}
.button {display:inline-block; width:50px; height:50px; margin:4px; background:#0077cc; border-radius:10px; line-height:50px; cursor:pointer; user-select:none; transition:0.1s; font-size:0.9em;}
.button.active {background:#ff6600;}
.stick {width:100px; height:100px; background:#0055aa; border-radius:50%; margin:10px auto; position:relative;}
.stick-indicator {width:20px; height:20px; background:#ffcc00; border-radius:50%; position:absolute; top:40px; left:40px;}
.trigger {width:60px; height:20px; background:#0077cc; margin:5px auto; border-radius:5px; transition:0.1s;}
.trigger.active {background:#ffcc00;}
.log {font-size:0.8em; color:#aaffaa; margin-top:5px; text-align:left; max-height:100px; overflow-y:auto; border-top:1px solid #0055aa; padding-top:5px;}
</style>
</head>
<body>

<h1>Ultimate IG / Gamepad Pro Tester</h1>
<p>Connect your controller(s). Everything will be automatically detected and logged.</p>

<div id="controllers"></div>

<script>
let gamepads={};
let logs=[];

function logInput(text){
  logs.push(text);
  if(logs.length>50) logs.shift();
  document.querySelectorAll('.log').forEach(l=>{l.textContent=logs.join('\n');});
}

function createControllerUI(index,gp){
  const container=document.createElement('div');
  container.className='controller';
  container.id='controller-'+index;

  const title=document.createElement('h2');
  title.textContent=gp.id||'Controller '+index;
  container.appendChild(title);

  // Buttons
  const buttonsDiv=document.createElement('div');
  buttonsDiv.id='buttons-'+index;
  gp.buttons.forEach((btn,i)=>{
    const button=document.createElement('div');
    button.className='button';
    button.id='c'+index+'b'+i;
    button.textContent=i;
    buttonsDiv.appendChild(button);
  });
  container.appendChild(buttonsDiv);

  // Sticks
  ['Left Stick','Right Stick'].forEach((stickName,sIndex)=>{
    const stickDiv=document.createElement('div');
    stickDiv.className='stick';
    const label=document.createElement('div');
    label.style.position='absolute'; label.style.top='-20px'; label.style.left='0px'; label.style.fontSize='0.9em';
    label.textContent=stickName;
    stickDiv.appendChild(label);
    const indicator=document.createElement('div');
    indicator.className='stick-indicator';
    indicator.id='c'+index+'s'+sIndex;
    stickDiv.appendChild(indicator);
    container.appendChild(stickDiv);
  });

  // Triggers / bumpers
  ['L1','L2','R1','R2'].forEach((trigName,tIndex)=>{
    const trigDiv=document.createElement('div');
    trigDiv.className='trigger';
    trigDiv.id='c'+index+'t'+tIndex;
    trigDiv.textContent=trigName;
    container.appendChild(trigDiv);
  });

  // Input log
  const logDiv=document.createElement('div');
  logDiv.className='log';
  container.appendChild(logDiv);

  document.getElementById('controllers').appendChild(container);
}

function updateController(index,gp){
  // Buttons
  gp.buttons.forEach((btn,i)=>{
    const el=document.getElementById('c'+index+'b'+i);
    if(el){
      btn.pressed ? el.classList.add('active') : el.classList.remove('active');
      if(btn.pressed) logInput(`Controller ${index} Button ${i} pressed`);
      if(btn.value && gp.vibrationActuator){
        gp.vibrationActuator.playEffect('dual-rumble',{duration:50,strongMagnitude:btn.value,weakMagnitude:btn.value});
      }
    }
  });

  // Sticks
  for(let s=0;s<2;s++){
    const x=gp.axes[s*2]||0;
    const y=gp.axes[s*2+1]||0;
    const ind=document.getElementById('c'+index+'s'+s);
    if(ind) ind.style.transform=`translate(${x*40}px,${y*40}px)`;
    logInput(`Controller ${index} ${s==0?'Left':'Right'} Stick: X=${x.toFixed(2)} Y=${y.toFixed(2)}`);
  }

  // Triggers / bumpers
  const triggers=[6,7,4,5]; // L2,R2,L1,R1
  triggers.forEach((btnIndex,i)=>{
    const trig=document.getElementById('c'+index+'t'+i);
    if(trig){
      gp.buttons[btnIndex].value>0 ? trig.classList.add('active') : trig.classList.remove('active');
      if(gp.buttons[btnIndex].value>0) logInput(`Controller ${index} ${trig.textContent} activated`);
    }
  });
}

function scanGamepads(){
  const gps=navigator.getGamepads?navigator.getGamepads():[];
  for(let i=0;i<gps.length;i++){
    const gp=gps[i];
    if(gp){
      if(!gamepads[i]){
        gamepads[i]=gp;
        createControllerUI(i,gp);
      }else{
        updateController(i,gp);
      }
    }
  }
  requestAnimationFrame(scanGamepads);
}

window.addEventListener("gamepadconnected",e=>{
  console.log("Controller connected:",e.gamepad);
  scanGamepads();
});
window.addEventListener("gamepaddisconnected",e=>{
  console.log("Controller disconnected:",e.gamepad);
  const cont=document.getElementById('controller-'+e.gamepad.index);
  if(cont) cont.remove();
  delete gamepads[e.gamepad.index];
});

scanGamepads();
</script>

</body>
</html>
